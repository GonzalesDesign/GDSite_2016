// SmoothScroll v1.2.1
// Licensed under the terms of the MIT license.
// People involved
//  - Balazs Galambosi (maintainer)
//  - Patrick Brunner  (original idea)
//  - Michael Herf     (Pulse Algorithm)
// Scroll Variables (tweakable)
// Other Variables
function initTest(){var e=!1
if(document.URL.indexOf("google.com/reader/view")>-1&&(e=!0),options.excluded){var t=options.excluded.split(/[,\n] ?/)
t.push("mail.google.com")
for(var o=t.length;o--;)if(document.URL.indexOf(t[o])>-1){observer&&observer.disconnect(),removeEvent("mousewheel",wheel),e=!0,isExcluded=!0
break}}e&&removeEvent("keydown",keydown),options.keyboardSupport&&!e&&addEvent("keydown",keydown)}function init(){if(document.body){var e=document.body,t=document.documentElement,o=window.innerHeight,n=e.scrollHeight
if(root=document.compatMode.indexOf("CSS")>=0?t:e,activeElement=e,initTest(),initDone=!0,top!=self)isFrame=!0
else if(n>o&&(e.offsetHeight<=o||t.offsetHeight<=o)){var i=!1,r=function(){i||t.scrollHeight==document.height||(i=!0,setTimeout(function(){t.style.height=document.height+"px",i=!1},500))}
t.style.height="auto",setTimeout(r,10)
var a={attributes:!0,childList:!0,characterData:!1}
if(observer=new MutationObserver(r),observer.observe(e,a),root.offsetHeight<=o){var l=document.createElement("div")
l.style.clear="both",e.appendChild(l)}}if(document.URL.indexOf("mail.google.com")>-1){var s=document.createElement("style")
s.innerHTML=".iu { visibility: hidden }",(document.getElementsByTagName("head")[0]||t).appendChild(s)}else if(document.URL.indexOf("www.facebook.com")>-1){var u=document.getElementById("home_stream")
u&&(u.style.webkitTransform="translateZ(0)")}options.fixedBackground||isExcluded||(e.style.backgroundAttachment="scroll",t.style.backgroundAttachment="scroll")}}function scrollArray(e,t,o,n){if(n||(n=1e3),directionCheck(t,o),1!=options.accelerationMax){var i=+new Date,r=i-lastScroll
if(r<options.accelerationDelta){var a=(1+30/r)/2
a>1&&(a=Math.min(a,options.accelerationMax),t*=a,o*=a)}lastScroll=+new Date}if(que.push({x:t,y:o,lastX:t<0?.99:-.99,lastY:o<0?.99:-.99,start:+new Date}),!pending){var l=e===document.body,s=function(i){for(var r=+new Date,a=0,u=0,c=0;c<que.length;c++){var d=que[c],f=r-d.start,m=f>=options.animationTime,p=m?1:f/options.animationTime
options.pulseAlgorithm&&(p=pulse(p))
var h=d.x*p-d.lastX>>0,v=d.y*p-d.lastY>>0
a+=h,u+=v,d.lastX+=h,d.lastY+=v,m&&(que.splice(c,1),c--)}l?window.scrollBy(a,u):(a&&(e.scrollLeft+=a),u&&(e.scrollTop+=u)),t||o||(que=[]),que.length?requestFrame(s,e,n/options.frameRate+1):pending=!1}
requestFrame(s,e,0),pending=!0}}function wheel(e){initDone||init()
var t=e.target,o=overflowingAncestor(t)
if(!o||e.defaultPrevented||isNodeName(activeElement,"embed")||isNodeName(t,"embed")&&/\.pdf/i.test(t.src))return!0
var n=e.wheelDeltaX||0,i=e.wheelDeltaY||0
return n||i||(i=e.wheelDelta||0),!(options.touchpadSupport||!isTouchpad(i))||(Math.abs(n)>1.2&&(n*=options.stepSize/120),Math.abs(i)>1.2&&(i*=options.stepSize/120),scrollArray(o,-n,-i),void e.preventDefault())}function keydown(e){var t=e.target,o=e.ctrlKey||e.altKey||e.metaKey||e.shiftKey&&e.keyCode!==key.spacebar
if(/input|textarea|select|embed/i.test(t.nodeName)||t.isContentEditable||e.defaultPrevented||o)return!0
if(isNodeName(t,"button")&&e.keyCode===key.spacebar)return!0
var n,i=0,r=0,a=overflowingAncestor(activeElement),l=a.clientHeight
switch(a==document.body&&(l=window.innerHeight),e.keyCode){case key.up:r=-options.arrowScroll
break
case key.down:r=options.arrowScroll
break
case key.spacebar:n=e.shiftKey?1:-1,r=-n*l*.9
break
case key.pageup:r=.9*-l
break
case key.pagedown:r=.9*l
break
case key.home:r=-a.scrollTop
break
case key.end:var s=a.scrollHeight-a.scrollTop-l
r=s>0?s+10:0
break
case key.left:i=-options.arrowScroll
break
case key.right:i=options.arrowScroll
break
default:return!0}scrollArray(a,i,r),e.preventDefault()}function mousedown(e){activeElement=e.target}function setCache(e,t){for(var o=e.length;o--;)cache[uniqueID(e[o])]=t
return t}function overflowingAncestor(e){var t=[],o=root.scrollHeight
do{var n=cache[uniqueID(e)]
if(n)return setCache(t,n)
if(t.push(e),o===e.scrollHeight){if(!isFrame||root.clientHeight+10<o)return setCache(t,document.body)}else if(e.clientHeight+10<e.scrollHeight&&(overflow=getComputedStyle(e,"").getPropertyValue("overflow-y"),"scroll"===overflow||"auto"===overflow))return setCache(t,e)}while(e=e.parentNode)}function addEvent(e,t,o){window.addEventListener(e,t,o||!1)}function removeEvent(e,t,o){window.removeEventListener(e,t,o||!1)}function isNodeName(e,t){return(e.nodeName||"").toLowerCase()===t.toLowerCase()}function directionCheck(e,t){e=e>0?1:-1,t=t>0?1:-1,direction.x===e&&direction.y===t||(direction.x=e,direction.y=t,que=[],lastScroll=0)}function isTouchpad(e){if(e){e=Math.abs(e),deltaBuffer.push(e),deltaBuffer.shift(),clearTimeout(deltaBufferTimer),deltaBufferTimer=setTimeout(function(){chrome.storage.local.set({deltaBuffer:deltaBuffer})},1e3)
var t=deltaBuffer[0]==deltaBuffer[1]&&deltaBuffer[1]==deltaBuffer[2],o=isDivisible(deltaBuffer[0],120)&&isDivisible(deltaBuffer[1],120)&&isDivisible(deltaBuffer[2],120)
return!(t||o)}}function isDivisible(e,t){return Math.floor(e/t)==e/t}function pulse_(e){var t,o,n
return e*=options.pulseScale,e<1?t=e-(1-Math.exp(-e)):(o=Math.exp(-1),e-=1,n=1-Math.exp(-e),t=o+n*(1-o)),t*options.pulseNormalize}function pulse(e){return e>=1?1:e<=0?0:(1==options.pulseNormalize&&(options.pulseNormalize/=pulse_(1)),pulse_(e))}var defaultOptions={frameRate:150,animationTime:1e3,stepSize:40,pulseAlgorithm:!0,pulseScale:8,pulseNormalize:1,accelerationDelta:20,accelerationMax:1,keyboardSupport:!0,arrowScroll:350,touchpadSupport:!0,fixedBackground:!0,excluded:""},options=defaultOptions,isExcluded=!1,isFrame=!1,direction={x:0,y:0},initDone=!1,root=document.documentElement,activeElement,observer,deltaBuffer=[120,120,120],key={left:37,up:38,right:39,down:40,spacebar:32,pageup:33,pagedown:34,end:35,home:36},que=[],pending=!1,lastScroll=+new Date,cache={}
setInterval(function(){cache={}},1e4)
var uniqueID=function(){var e=0
return function(t){return t.uniqueID||(t.uniqueID=e++)}}(),deltaBufferTimer,requestFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(e,t,o){window.setTimeout(e,o||1e3/60)}}(),MutationObserver=window.MutationObserver||window.WebKitMutationObserver
addEvent("mousedown",mousedown),addEvent("mousewheel",wheel),addEvent("load",init)
